---
import magnolia from '@/lib/magnolia'
import Image from '@/components/Image'
import Video from '@/components/Video.astro'
import IconPlus from '@/assets/icons/plus.svg'
import CallToAction from './CallToAction.astro'

interface Item {
  title: string
  description: string
  icon: string
}

const currentLocale = Astro.currentLocale!

async function data(
  path: string,
  callback: (data: Record<string, string>) => any
) {
  return magnolia
    .get(`/pages/platform${path}`, { lang: currentLocale })
    .then(callback)
}

async function items(callback: (item: Item, index: number) => any) {
  return magnolia
    .get('/pages/platform/details/items/@nodes', { lang: currentLocale })
    .then((items: Item[]) => items.map(callback))
}
---

<section class="mb-20 px-5 sm:px-10 lg:px-13">
  {
    data('/details', ({ title, description }) => (
      <div
        class:list={[
          'mb-9 flex flex-col gap-6 xl:mb-24 xl:flex-row',
          'xl:items-center'
        ]}
      >
        <h2
          class:list={[
            'pb-4 border-b-2 font-bold text-3xl text-balance text-orange-600',
            'xl:shrink-0 xl:pb-0 xl:border-b-0 xl:5xl'
          ]}
        >
          {title}
        </h2>
        <p
          class:list={[
            'text-lg text-pretty xl:pl-12 xl:border-l-2 xl:border-orange-600',
            'xl:text-xl/snug'
          ]}
        >
          {description}
        </p>
      </div>
    ))
  }
  <div class="mb-12 grid xl:grid-cols-3 md:mb-32">
    {
      items(({ icon, title, description }, index) => (
        <article
          class:list={[
            'relative py-15 px-6 from-white to-red-100 even:rounded-tl-lg',
            'even:bg-linear-240 sm:px-12 xl:py-12'
          ]}
        >
          {index !== 0 && (
            <IconPlus
              class:list={[
                'absolute inset-x-0 w-6 my-4 mx-auto text-orange-600',
                index % 2 === 0
                  ? 'top-0 xl:right-auto'
                  : 'bottom-full xl:left-auto xl:right-full',
                'xl:inset-y-0 xl:my-auto xl:mx-4'
              ]}
            />
          )}
          <Image class="size-11 object-contain" src={icon} />
          <h3 class="mt-5 mb-3 font-bold text-xl/tight uppercase">{title}</h3>
          <p class="leading-snug">{description}</p>
        </article>
      ))
    }
  </div>
  {
    data('/details/register', ({ title, description, videoId }) => (
      <section class="grid gap-y-10 md:grid-cols-[9fr_8fr] md:items-center">
        <div class="md:ml-12">
          <h3 class="font-bold text-xl text-orange-600 uppercase">{title}</h3>
          <p class="mt-3 text-xl/tight text-balance">{description}</p>
        </div>
        <Video class="max-w-none md:row-start-1" id={videoId} />
      </section>
    ))
  }
  {
    data('/details/login', ({ title, description, videoId }) => (
      <section
        class={'my-26 grid gap-y-10 md:grid-cols-[8fr_9fr] md:items-center'}
      >
        <div class="md:mr-12 md:text-right">
          <h3 class="font-bold text-xl text-orange-600 uppercase">{title}</h3>
          <p class="mt-3 text-xl/tight text-balance">{description}</p>
        </div>
        <Video id={videoId} />
      </section>
    ))
  }
  <CallToAction>
    {Astro.locals.t['want_to_know_more']}
  </CallToAction>
</section>
